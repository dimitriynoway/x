{"ast":null,"code":"var _jsxFileName = \"/Users/dmitriybabenko/Desktop/finalMes/client/src/pages/Chat.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useSnackbar } from 'notistack';\nimport useMediaQuery from '@mui/material/useMediaQuery';\nimport { useHistory } from 'react-router-dom';\nimport colors from '../colors';\nimport { ErrorHandler } from '../notifications/functions';\nimport { WarningPage } from '../components/Warning';\nimport { ChatWindow } from '../components/ChatWindow';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Chat = ({\n  socket\n}) => {\n  _s();\n\n  const history = useHistory();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const windowWidthLess900 = useMediaQuery('(max-width:960px)');\n  const handleError = ErrorHandler(enqueueSnackbar);\n  const [messages, setMessages] = useState([]);\n  const [usersInDB, setUsersInDB] = useState([]);\n  const [onlineUsersArray, setOnlineUsersArray] = useState([]);\n  const [showAdmin, setShowAdmin] = useState(false);\n  const [warning, setWarning] = useState(false);\n  const [userRole, setUserRole] = useState('user');\n  const [warningMessage, setWarningMessage] = useState('You entered from two windows or connection was interrupted');\n  const [warningColor, setWarningColor] = useState('');\n\n  const sendMessage = (e, msg, setMessage) => {\n    if (e.key === 'Enter' || e.type === 'click') {\n      if (!msg) return;\n      socket.emit('message', {\n        msg\n      });\n      setMessage('');\n    }\n  };\n\n  const getUserFromBan = user => {\n    console.log('userFromBan', user);\n    console.log('dbusers', usersInDB);\n    const updatedUsersInDB = usersInDB.map(item => {\n      if (item.id === user._id) {\n        return { ...item,\n          banned: user.banned\n        };\n      }\n\n      return item;\n    });\n    setUsersInDB([...updatedUsersInDB]);\n  };\n\n  const getUserFromMute = user => {\n    console.log('userFromMute', user);\n    console.log('dbusers', usersInDB);\n    const updatedUsersInDB = usersInDB.map(item => {\n      if (item.id === user._id) {\n        return { ...item,\n          mutted: user.mutted\n        };\n      }\n\n      return item;\n    });\n    setUsersInDB([...updatedUsersInDB]);\n  };\n\n  const userDisconnect = ({\n    disconnectedUser\n  }) => {\n    console.log('user disconnected');\n    const copy = onlineUsersArray.find(item => item.id === disconnectedUser.id);\n\n    if (copy) {\n      const newOnline = onlineUsersArray.filter(item => item.id !== disconnectedUser.id);\n      setOnlineUsersArray([...newOnline]);\n    }\n  };\n\n  const youConnected = ({\n    clients,\n    username,\n    messages\n  }) => {\n    console.log('you connected');\n    setWarning(false);\n    setOnlineUsersArray(clients);\n    setMessages(messages);\n  };\n\n  const newUserConnection = ({\n    client\n  }) => {\n    console.log('new user connected', client);\n    console.log('users in db: ', usersInDB);\n    const justCreatedUser = usersInDB.find(user => user.id === client.id);\n\n    if (!justCreatedUser) {\n      setUsersInDB(prev => [...prev, client]);\n    }\n\n    const newOnline = onlineUsersArray.filter(item => item.id !== client.id);\n    setOnlineUsersArray([...newOnline, client]);\n  };\n\n  useEffect(() => {\n    socket.on('getUserFromBan', getUserFromBan);\n    return () => {\n      socket.removeAllListeners('getUserFromBan');\n    };\n  }, [usersInDB]);\n  useEffect(() => {\n    socket.on('getUserFromMute', getUserFromMute);\n    return () => {\n      socket.removeAllListeners('getUserFromMute');\n    };\n  }, [usersInDB]);\n  useEffect(() => {\n    socket.on('user disconnect', userDisconnect);\n    socket.on('you connected', youConnected);\n    socket.on('new user connection', newUserConnection);\n    return () => {\n      socket.removeAllListeners('user disconnect');\n      socket.removeAllListeners('you connected');\n      socket.removeAllListeners('new user connection');\n    };\n  }, [onlineUsersArray, usersInDB]);\n  useEffect(() => {\n    socket.once('admin', () => {\n      setUserRole('admin');\n    });\n    socket.once('getUsersFromServer', users => {\n      setUsersInDB([...users]);\n    });\n    return () => {\n      socket.removeAllListeners('admin');\n      socket.removeAllListeners('getUsersFromServer');\n    };\n  }, [usersInDB, userRole]);\n  useEffect(() => {\n    socket.on('message', ({\n      message,\n      userColor,\n      username\n    }) => {\n      setMessages(prev => [...prev, {\n        username,\n        message,\n        bgColor: colors[userColor] || 'red',\n        type: 'user'\n      }]);\n    });\n    socket.on('mutted', () => {\n      handleError('You are mutted', windowWidthLess900);\n    });\n    socket.on('delay', time => {\n      handleError(`Delay. Left ${time} seconds`, windowWidthLess900);\n    });\n    socket.on('dissconnect type', ({\n      type\n    }) => {\n      localStorage.removeItem('token');\n\n      if (type === 'banned') {\n        setWarningMessage('Loooser... You have been banned!');\n        setWarningColor('orange');\n      }\n    });\n    socket.on('error', err => {\n      setWarningMessage(err.message);\n      setWarning(true);\n      localStorage.removeItem('token');\n    });\n    socket.on('connect_error', err => {\n      setWarningMessage(err.message);\n      setWarning(true);\n      localStorage.removeItem('token');\n    });\n    socket.on('disconnect', () => {\n      setWarning(true);\n    });\n    return () => {\n      socket.removeAllListeners('message');\n      socket.removeAllListeners('mutted');\n      socket.removeAllListeners('delay');\n      socket.removeAllListeners('dissconnect type');\n      socket.removeAllListeners('error');\n      socket.removeAllListeners('connect_error');\n      socket.removeAllListeners('disconnect');\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: warning ? /*#__PURE__*/_jsxDEV(WarningPage, {\n      warningMessage: warningMessage,\n      warningColor: warningColor,\n      windowWidthLess900: windowWidthLess900\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 6\n    }, this) : /*#__PURE__*/_jsxDEV(ChatWindow, {\n      socket: socket,\n      userRole: userRole,\n      setShowAdmin: setShowAdmin,\n      windowWidthLess900: windowWidthLess900,\n      onlineUsersArray: onlineUsersArray,\n      showAdmin: showAdmin,\n      usersInDB: usersInDB,\n      messages: messages,\n      sendMessage: sendMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 6\n    }, this)\n  }, void 0, false);\n};\n\n_s(Chat, \"iUH/t5XNWaLsssMQPYIv4qBpDzo=\", false, function () {\n  return [useHistory, useSnackbar, useMediaQuery];\n});\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/Users/dmitriybabenko/Desktop/finalMes/client/src/pages/Chat.js"],"names":["React","useEffect","useState","useSnackbar","useMediaQuery","useHistory","colors","ErrorHandler","WarningPage","ChatWindow","Chat","socket","history","enqueueSnackbar","windowWidthLess900","handleError","messages","setMessages","usersInDB","setUsersInDB","onlineUsersArray","setOnlineUsersArray","showAdmin","setShowAdmin","warning","setWarning","userRole","setUserRole","warningMessage","setWarningMessage","warningColor","setWarningColor","sendMessage","e","msg","setMessage","key","type","emit","getUserFromBan","user","console","log","updatedUsersInDB","map","item","id","_id","banned","getUserFromMute","mutted","userDisconnect","disconnectedUser","copy","find","newOnline","filter","youConnected","clients","username","newUserConnection","client","justCreatedUser","prev","on","removeAllListeners","once","users","message","userColor","bgColor","time","localStorage","removeItem","err"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useSnackbar } from 'notistack';\nimport useMediaQuery from '@mui/material/useMediaQuery';\nimport { useHistory } from 'react-router-dom';\nimport colors from '../colors';\nimport { ErrorHandler } from '../notifications/functions';\nimport { WarningPage } from '../components/Warning';\nimport { ChatWindow } from '../components/ChatWindow';\n\nconst Chat = ({ socket }) => {\n\tconst history = useHistory();\n\tconst { enqueueSnackbar } = useSnackbar();\n\tconst windowWidthLess900 = useMediaQuery('(max-width:960px)');\n\tconst handleError = ErrorHandler(enqueueSnackbar);\n\n\tconst [messages, setMessages] = useState([]);\n\tconst [usersInDB, setUsersInDB] = useState([]);\n\tconst [onlineUsersArray, setOnlineUsersArray] = useState([]);\n\tconst [showAdmin, setShowAdmin] = useState(false);\n\tconst [warning, setWarning] = useState(false);\n\tconst [userRole, setUserRole] = useState('user');\n\tconst [warningMessage, setWarningMessage] = useState('You entered from two windows or connection was interrupted');\n\tconst [warningColor, setWarningColor] = useState('');\n\n\tconst sendMessage = (e, msg, setMessage) => {\n\t\tif (e.key === 'Enter' || e.type === 'click') {\n\t\t\tif (!msg) return;\n\t\t\tsocket.emit('message', ({ msg }));\n\t\t\tsetMessage('');\n\t\t}\n\t};\n\n\tconst getUserFromBan = (user) => {\n\t\tconsole.log('userFromBan', user);\n\t\tconsole.log('dbusers', usersInDB);\n\t\tconst updatedUsersInDB = usersInDB.map((item) => {\n\t\t\tif (item.id === user._id) {\n\t\t\t\treturn { ...item, banned: user.banned };\n\t\t\t}\n\t\t\treturn item;\n\t\t});\n\t\tsetUsersInDB([...updatedUsersInDB]);\n\t};\n\n\tconst getUserFromMute = (user) => {\n\t\tconsole.log('userFromMute', user);\n\t\tconsole.log('dbusers', usersInDB);\n\t\tconst updatedUsersInDB = usersInDB.map((item) => {\n\t\t\tif (item.id === user._id) {\n\t\t\t\treturn { ...item, mutted: user.mutted };\n\t\t\t}\n\t\t\treturn item;\n\t\t});\n\t\tsetUsersInDB([...updatedUsersInDB]);\n\t};\n\n\tconst userDisconnect = ({ disconnectedUser }) => {\n\t\tconsole.log('user disconnected');\n\t\tconst copy = onlineUsersArray.find((item) => item.id === disconnectedUser.id);\n\t\tif (copy) {\n\t\t\tconst newOnline = onlineUsersArray.filter((item) => item.id !== disconnectedUser.id);\n\t\t\tsetOnlineUsersArray([...newOnline]);\n\t\t}\n\t};\n\tconst youConnected = ({ clients, username, messages }) => {\n\t\tconsole.log('you connected');\n\t\tsetWarning(false);\n\t\tsetOnlineUsersArray(clients);\n\t\tsetMessages(messages);\n\t};\n\tconst newUserConnection = ({ client }) => {\n\t\tconsole.log('new user connected', client);\n\t\tconsole.log('users in db: ', usersInDB);\n\t\tconst justCreatedUser = usersInDB.find((user) => user.id === client.id);\n\t\tif (!justCreatedUser) {\n\t\t\tsetUsersInDB((prev) => [...prev, client]);\n\t\t}\n\t\tconst newOnline = onlineUsersArray.filter((item) => item.id !== client.id);\n\n\t\tsetOnlineUsersArray([...newOnline, client]);\n\t};\n\n\tuseEffect(() => {\n\t\tsocket.on('getUserFromBan', getUserFromBan);\n\t\treturn () => {\n\t\t\tsocket.removeAllListeners('getUserFromBan');\n\t\t};\n\t}, [usersInDB]);\n\n\tuseEffect(() => {\n\t\tsocket.on('getUserFromMute', getUserFromMute);\n\t\treturn () => {\n\t\t\tsocket.removeAllListeners('getUserFromMute');\n\t\t};\n\t}, [usersInDB]);\n\n\tuseEffect(() => {\n\t\tsocket.on('user disconnect', userDisconnect);\n\t\tsocket.on('you connected', youConnected);\n\t\tsocket.on('new user connection', newUserConnection);\n\t\treturn () => {\n\t\t\tsocket.removeAllListeners('user disconnect');\n\t\t\tsocket.removeAllListeners('you connected');\n\t\t\tsocket.removeAllListeners('new user connection');\n\t\t};\n\t}, [onlineUsersArray, usersInDB]);\n\n\tuseEffect(() => {\n\t\tsocket.once('admin', () => {\n\t\t\tsetUserRole('admin');\n\t\t});\n\t\tsocket.once('getUsersFromServer', (users) => {\n\t\t\tsetUsersInDB([...users]);\n\t\t});\n\t\treturn () => {\n\t\t\tsocket.removeAllListeners('admin');\n\t\t\tsocket.removeAllListeners('getUsersFromServer');\n\t\t};\n\t}, [usersInDB, userRole]);\n\n\tuseEffect(() => {\n\t\tsocket.on('message', ({ message, userColor, username }) => {\n\t\t\tsetMessages((prev) => [...prev, {\n\t\t\t\tusername,\n\t\t\t\tmessage,\n\t\t\t\tbgColor: colors[userColor] || 'red',\n\t\t\t\ttype: 'user',\n\t\t\t},\n\t\t\t]);\n\t\t});\n\n\t\tsocket.on('mutted', () => {\n\t\t\thandleError('You are mutted', windowWidthLess900);\n\t\t});\n\n\t\tsocket.on('delay', (time) => {\n\t\t\thandleError(`Delay. Left ${time} seconds`, windowWidthLess900);\n\t\t});\n\n\t\tsocket.on('dissconnect type', ({ type }) => {\n\t\t\tlocalStorage.removeItem('token');\n\t\t\tif (type === 'banned') {\n\t\t\t\tsetWarningMessage('Loooser... You have been banned!');\n\t\t\t\tsetWarningColor('orange');\n\t\t\t}\n\t\t});\n\t\tsocket.on('error', (err) => {\n\t\t\tsetWarningMessage(err.message);\n\t\t\tsetWarning(true);\n\t\t\tlocalStorage.removeItem('token');\n\t\t});\n\t\tsocket.on('connect_error', (err) => {\n\t\t\tsetWarningMessage(err.message);\n\t\t\tsetWarning(true);\n\t\t\tlocalStorage.removeItem('token');\n\t\t});\n\t\tsocket.on('disconnect', () => {\n\t\t\tsetWarning(true);\n\t\t});\n\n\t\treturn () => {\n\t\t\tsocket.removeAllListeners('message');\n\t\t\tsocket.removeAllListeners('mutted');\n\t\t\tsocket.removeAllListeners('delay');\n\t\t\tsocket.removeAllListeners('dissconnect type');\n\t\t\tsocket.removeAllListeners('error');\n\t\t\tsocket.removeAllListeners('connect_error');\n\t\t\tsocket.removeAllListeners('disconnect');\n\t\t};\n\t}, []);\n\n\treturn (\n\t\t<>\n\t\t\t{warning\n\t\t\t\t? (\n\t\t\t\t\t<WarningPage\n\t\t\t\t\t\twarningMessage={warningMessage}\n\t\t\t\t\t\twarningColor={warningColor}\n\t\t\t\t\t\twindowWidthLess900={windowWidthLess900}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t\t: (\n\t\t\t\t\t<ChatWindow\n\t\t\t\t\t\tsocket={socket}\n\t\t\t\t\t\tuserRole={userRole}\n\t\t\t\t\t\tsetShowAdmin={setShowAdmin}\n\t\t\t\t\t\twindowWidthLess900={windowWidthLess900}\n\t\t\t\t\t\tonlineUsersArray={onlineUsersArray}\n\t\t\t\t\t\tshowAdmin={showAdmin}\n\t\t\t\t\t\tusersInDB={usersInDB}\n\t\t\t\t\t\tmessages={messages}\n\t\t\t\t\t\tsendMessage={sendMessage}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t</>\n\t);\n};\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}